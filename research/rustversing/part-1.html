<!DOCTYPE html><html lang="en" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="Reversing Rust 1 Research" /><meta name="author" content="Zeropio" /><meta property="og:locale" content="en" /><meta name="description" content="Why? you may ask. I had asked myself the same question, but a friend provided me with a different perspective. In the early days of reversing, back in the 80s (I guess?), people didn’t know how to reverse a simple C binary like we do today. They started by examining plain disassembly, gradually progressing to where we are now. But what about Rust? It is often said that reversing Rust is far from being stable. Personally, I have noticed a significant lack of blog posts discussing reversing in this language." /><meta property="og:description" content="Why? you may ask. I had asked myself the same question, but a friend provided me with a different perspective. In the early days of reversing, back in the 80s (I guess?), people didn’t know how to reverse a simple C binary like we do today. They started by examining plain disassembly, gradually progressing to where we are now. But what about Rust? It is often said that reversing Rust is far from being stable. Personally, I have noticed a significant lack of blog posts discussing reversing in this language." /><link rel="canonical" href="https://zeropio.ninja//research/rustversing/part-1" /><meta property="og:url" content="https://zeropio.ninja//research/rustversing/part-1" /><meta property="og:site_name" content="Zeropio’s Dojo" /><meta property="og:image" content="https://zeropio.ninja//assets/img/thumbnails/rustversing-1.png" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2023-05-20T00:00:00+02:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://zeropio.ninja//assets/img/thumbnails/rustversing-1.png" /><meta property="twitter:title" content="Reversing Rust 1 Research" /><meta name="twitter:site" content="@ZeropioWasTaken" /><meta name="twitter:creator" content="@ZeropioWasTaken" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Zeropio","url":"https://twitter.com/ZeropioWasTaken"},"dateModified":"2023-05-20T00:00:00+02:00","datePublished":"2023-05-20T00:00:00+02:00","description":"Why? you may ask. I had asked myself the same question, but a friend provided me with a different perspective. In the early days of reversing, back in the 80s (I guess?), people didn’t know how to reverse a simple C binary like we do today. They started by examining plain disassembly, gradually progressing to where we are now. But what about Rust? It is often said that reversing Rust is far from being stable. Personally, I have noticed a significant lack of blog posts discussing reversing in this language.","headline":"Reversing Rust 1 Research","image":"https://zeropio.ninja//assets/img/thumbnails/rustversing-1.png","mainEntityOfPage":{"@type":"WebPage","@id":"https://zeropio.ninja//research/rustversing/part-1"},"url":"https://zeropio.ninja//research/rustversing/part-1"}</script><title>Reversing Rust 1 | Research | Zeropio's Dojo</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Zeropio's Dojo"><meta name="application-name" content="Zeropio's Dojo"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.1/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.1/dist/jquery.min.js"></script><body data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/icon.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title"> <a href="/">Zeropio's Dojo</a></div><div class="site-subtitle font-italic">Cyberninja</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/zeropio" aria-label="github" target="_blank" rel="noopener noreferrer"> <i class="fab fa-github"></i> </a> <a href="https://ctftime.org/team/212175" aria-label="ctftime" target="_blank" rel="noopener noreferrer"> <i class="fas fa-flag"></i> </a> <a href="https://app.hackthebox.com/profile/380109" aria-label="hackthebox" target="_blank" rel="noopener noreferrer"> <i class="fas fa-cube"></i> </a> <a href="https://twitter.com/ZeropioWasTaken" aria-label="twitter" target="_blank" rel="noopener noreferrer"> <i class="fab fa-twitter"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Reversing Rust 1 | Research</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Reversing Rust 1 | Research</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1684533600" data-df="ll" data-toggle="tooltip" data-placement="bottom"> May 20, 2023 </em> </span><div class="mt-3 mb-3"> <a href="/assets/img/thumbnails/rustversing-1.png" class="popup img-link preview-img shimmer"><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1200 630'%3E%3C/svg%3E" data-src="/assets/img/thumbnails/rustversing-1.png" alt="Preview Image" width="1200" height="630" class="lazyload" data-proofer-ignore></a></div><div class="d-flex justify-content-between"> <span> By <em> <a href="https://twitter.com/ZeropioWasTaken">Zeropio</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="3229 words"> <em>17 min</em> read</span></div></div></div><div class="post-content"><p>Why? you may ask. I had asked myself the same question, but a friend provided me with a different perspective. In the early days of reversing, back in the 80s (I guess?), people didn’t know how to reverse a simple C binary like we do today. They started by examining plain disassembly, gradually progressing to where we are now. But what about Rust? It is often said that reversing Rust is far from being stable. Personally, I have noticed a significant lack of blog posts discussing reversing in this language.</p><p>This won’t be your typical blog praising the merits of Rust and why you should use it. On the contrary, my goal is the opposite. I want to explore the process of reversing Rust binaries and compare them to C binaries. I aim to understand the patterns used by the Rust compiler and improve my skills in reversing Rust binaries. So, instead of a series praising the virtues of Rust, this will focus on how we can dismantle one of its (today’s) strong features—its natural obfuscation.</p><p>In future posts, I will attempt to reverse-engineer some malware written in Rust (either my own or using existing “<em>in the wild</em>” Rust malware) and develop tools that can aid us in reversing it.</p><p>Get ready, Rustaceans! 😈</p><blockquote><p>Don’t take anything seriously!</p></blockquote><p><br /></p><hr /><h2 id="introduction"><span class="mr-2">Introduction</span><a href="#introduction" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>First things first, what am I going to do?</p><p>I will engage in simple Rust programming paired with some C examples. I will cover everything from a basic “<em>Hello World</em>” program to binary exploitation. As mentioned in previous posts, I won’t dive into the absolute basics. While I’m not a professional, I believe it’s more valuable for me to focus on what I’m doing and why, rather than explaining fundamental concepts that others can explain better than I can.</p><p>Rest assured, I will do my best. I promise.</p><p><br /></p><hr /><h2 id="hello-rust-hello-c"><span class="mr-2">Hello Rust! Hello C!</span><a href="#hello-rust-hello-c" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Let’s start with something simple: some “<em>Hello, World!</em>” programs.</p><div class="language-rust highlighter-rouge"><div class="code-header"> <span data-label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nf">hello</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">fn</span> <span class="nf">hello</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">let</span> <span class="n">language</span> <span class="o">=</span> <span class="s">"Rust"</span><span class="p">;</span>
    <span class="nd">println!</span><span class="p">(</span><span class="s">"Hello from {}!"</span><span class="p">,</span> <span class="n">language</span><span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><div class="language-c highlighter-rouge"><div class="code-header"> <span data-label-text="C"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">hello</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">hello</span><span class="p">()</span> <span class="p">{</span>
    <span class="kt">char</span><span class="o">*</span> <span class="n">language</span> <span class="o">=</span> <span class="s">"C"</span><span class="p">;</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"Hello from %s!</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">language</span><span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><p>The first and most obvious difference is the file size. While the C binary has a size of <strong>15 KB</strong>, the Rust binary is <strong>3.9 MB</strong>.</p><blockquote><p>Both were compiled using the default options for <code class="language-plaintext highlighter-rouge">gcc</code> and <code class="language-plaintext highlighter-rouge">rustc</code>.</p></blockquote><p><br /></p><h3 id="compilation-checks"><span class="mr-2">Compilation Checks</span><a href="#compilation-checks" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Now let’s dive into the compilation details:</p><div file="Rust" class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Rust"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="gp">$</span><span class="w"> </span>file rust
<span class="go">rust: ELF 64-bit LSB pie executable, x86-64, version 1 (SYSV), dynamically linked,
interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]=a9f161505a45966c69dfda1dc9d3fa3a110c56f7,
for GNU/Linux 4.4.0, with debug_info, not stripped
</span></pre></table></code></div></div><div file="C" class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="C"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="gp">$</span><span class="w"> </span>file c
<span class="go">c: ELF 64-bit LSB pie executable, x86-64, version 1 (SYSV), dynamically linked,
interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]=9bfcfee9c3a5c078d45c8896a395f85c8216b029,
for GNU/Linux 4.4.0, not stripped
</span></pre></table></code></div></div><p>The compilation flags are almost the same, except for the presence of <code class="language-plaintext highlighter-rouge">debug_info</code> in Rust. Perhaps that’s why the Rust binary has a larger size. By default, Rust statically links all libraries into the executable and includes symbols for debugging. However, when checking with the <code class="language-plaintext highlighter-rouge">file</code> command, it appears to recognize it as dynamically linked. To ensure we are dynamically linking it, let’s use <code class="language-plaintext highlighter-rouge">rustc -C prefer-dynamic</code>.</p><p>By doing so, we were able to reduce the file size from <strong>3.9 MB</strong> to <strong>17 KB</strong>! It is now almost equivalent to the C binary, and we have eliminated the <code class="language-plaintext highlighter-rouge">debug_info</code>.</p><div file="Rust" class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Rust"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="gp">$</span><span class="w"> </span>file rust
<span class="go">rust: ELF 64-bit LSB pie executable, x86-64, version 1 (SYSV), dynamically linked,
interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]=336b8052e7a465c6f3fdec0065e7a9407ea00451,
for GNU/Linux 4.4.0, not stripped
</span></pre></table></code></div></div><p><br /></p><h3 id="security-checks"><span class="mr-2">Security Checks</span><a href="#security-checks" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Now let’s check their security:</p><div file="Rust" class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Rust"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="gp">$</span><span class="w"> </span>checksec rust
<span class="go">[*] '/home/zeropio/Desktop/rustversing/rust'
    Arch:     amd64-64-little
    RELRO:    Full RELRO
    Stack:    No canary found
    NX:       NX enabled
    PIE:      PIE enabled
</span></pre></table></code></div></div><div file="C" class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="C"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="gp">$</span><span class="w"> </span>checksec c
<span class="go">[*] '/home/zeropio/Desktop/rustversing/c'
    Arch:     amd64-64-little
    RELRO:    Partial RELRO
    Stack:    No canary found
    NX:       NX enabled
    PIE:      PIE enabled
</span></pre></table></code></div></div><p>Oh! Rust has a default full RELRO, which theoretically decreases execution speed. However, considering all the techniques used by Rust and the statically linked libraries, this shouldn’t be a problem. Upon further investigation, we discovered that Rust doesn’t support Stack Canaries!</p><p>But neither does C add it by default. Compiling the C binary with the <code class="language-plaintext highlighter-rouge">-fstack-protector-all</code> flag will provide us with a stack canary. After participating in several CTFs, all of which employed stack canaries, and hearing numerous discussions about the importance of securing everything within a binary, I wondered why GCC doesn’t enable it by default. After some research, I came across this report: <a href="https://people.eecs.berkeley.edu/~daw/papers/shadow-asiaccs15.pdf">The Performance Cost of Shadow Stacks and Stack Canaries</a>. While it’s true that these measures may not provide the expected mitigation for binary exploitation, the decision to disable them by default due to performance issues seems kinda funny.</p><p><br /></p><h3 id="actual-reversing"><span class="mr-2">Actual Reversing</span><a href="#actual-reversing" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Now it’s time to reverse both binaries. Initially, I will be using BinaryNinja for this purpose. Later, I will compare different outputs with DogBolt.</p><h4 id="main-function"><span class="mr-2">Main Function</span><a href="#main-function" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>As soon as we open both files, differences start to show. First, let’s take a look at the symbols: <a href="/assets/img/research/rustversing/symbols-cmp.png" class="popup img-link "><img data-src="/assets/img/research/rustversing/symbols-cmp.png" alt="" class="lazyload" data-proofer-ignore></a></p><blockquote><p>Note that all the <code class="language-plaintext highlighter-rouge">__builtin_...</code> functions are present in the Rust binaries as well, just below the screenshot.</p></blockquote><p><br /></p><p>The difference is quite evident, isn’t it? The Rust binary has two different <code class="language-plaintext highlighter-rouge">main</code> functions: the actual <code class="language-plaintext highlighter-rouge">main</code> and (in this case) <code class="language-plaintext highlighter-rouge">rust::main::h2d88d26866781a19</code>. However, both binaries have the same <code class="language-plaintext highlighter-rouge">_start</code> function, with one significant difference afterward. In Rust, the <code class="language-plaintext highlighter-rouge">main</code> function calls the other <code class="language-plaintext highlighter-rouge">main</code> function: <a href="/assets/img/research/rustversing/main-cmp-1.png" class="popup img-link "><img data-src="/assets/img/research/rustversing/main-cmp-1.png" alt="" class="lazyload" data-proofer-ignore></a></p><p><br /></p><p>As we can observe, the C <code class="language-plaintext highlighter-rouge">main</code> function calls the <code class="language-plaintext highlighter-rouge">hello</code> function. On the other hand, the Rust <code class="language-plaintext highlighter-rouge">hello</code> function is invoked within the <code class="language-plaintext highlighter-rouge">rust::main::h2d88d26866781a19</code> function: <a href="/assets/img/research/rustversing/main-cmp-2.png" class="popup img-link "><img data-src="/assets/img/research/rustversing/main-cmp-2.png" alt="" class="lazyload" data-proofer-ignore></a></p><p>C binaries save the RBP register, while Rust binaries save the RAX register. Quite curious, isn’t it?</p><p><br /></p><h4 id="hello-function"><span class="mr-2">Hello Function</span><a href="#hello-function" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Let’s move on to the <code class="language-plaintext highlighter-rouge">hello</code> function: <a href="/assets/img/research/rustversing/hello-cmp-1.png" class="popup img-link "><img data-src="/assets/img/research/rustversing/hello-cmp-1.png" alt="" class="lazyload" data-proofer-ignore></a></p><p><br /></p><p>As we can see, there are <strong>significantly</strong> more instructions in the Rust binaries compared to the C binaries. However, the main difference lies in the handling of strings. In the C binary, we have our hardcoded string there (without the variable), whereas in Rust, it is not immediately visible. The <code class="language-plaintext highlighter-rouge">var_40</code> seems to be holding the string we want to print inside <code class="language-plaintext highlighter-rouge">data_3d68</code>, but that section doesn’t provide much information: <a href="/assets/img/research/rustversing/rust-string-1.png" class="popup img-link "><img data-src="/assets/img/research/rustversing/rust-string-1.png" alt="" class="lazyload" data-proofer-ignore></a> <em>data_3d68 visualized</em></p><p>We can attempt to construct a string from there, but it doesn’t seem like a straightforward process: <a href="/assets/img/research/rustversing/rust-string-2.png" class="popup img-link "><img data-src="/assets/img/research/rustversing/rust-string-2.png" alt="" class="lazyload" data-proofer-ignore></a> <em>data_3d68 as array of char</em></p><p><br /></p><p>Here’s where things get interesting. When we examine the strings in both the C and Rust binaries, we notice a significant difference: <a href="/assets/img/research/rustversing/rust-string-3.png" class="popup img-link "><img data-src="/assets/img/research/rustversing/rust-string-3.png" alt="" class="lazyload" data-proofer-ignore></a> <em>Only showing strings being used on the binary</em></p><p>All the hardcoded strings in C are easily identifiable (although the variable <code class="language-plaintext highlighter-rouge">language</code> holding the char <code class="language-plaintext highlighter-rouge">C</code> is not visible because Binja searches for strings based on a minimum <em>hex-to-string</em> coincidence, so a larger word is needed for detection). However, the Rust strings appear within another block. We can see the value of the <code class="language-plaintext highlighter-rouge">language</code> variable (<code class="language-plaintext highlighter-rouge">Rust</code>) before the rest of the hardcoded string, but it is contained within another peculiar reference.</p><p>So, if Binja is identifying the string as being used, where is it? We can jump to the memory address and find it: <a href="/assets/img/research/rustversing/rust-string-4.png" class="popup img-link "><img data-src="/assets/img/research/rustversing/rust-string-4.png" alt="" class="lazyload" data-proofer-ignore></a></p><p>Let’s format it a bit: <a href="/assets/img/research/rustversing/rust-string-5.png" class="popup img-link "><img data-src="/assets/img/research/rustversing/rust-string-5.png" alt="" class="lazyload" data-proofer-ignore></a></p><p><br /></p><p>Now the <code class="language-plaintext highlighter-rouge">rust::hello</code> function appears to be clearer: <a href="/assets/img/research/rustversing/rust-hello-1.png" class="popup img-link "><img data-src="/assets/img/research/rustversing/rust-hello-1.png" alt="" class="lazyload" data-proofer-ignore></a></p><p><br /></p><p>We have located our string. Now we need to understand how Rust prints it. In the C binary, the <code class="language-plaintext highlighter-rouge">printf</code> syscall is used to print the string. However, in Rust, it first calls <code class="language-plaintext highlighter-rouge">core::fmt::ArgumentV1::new_display</code>, then <code class="language-plaintext highlighter-rouge">core::fmt::Arguments::new_v1</code>, and finally returns <code class="language-plaintext highlighter-rouge">std::io::stdio::_print</code>. Using the Binja decompiler, we can obtain a clearer flow of the program. We can begin assigning names to variables to achieve a more organized view: <a href="/assets/img/research/rustversing/rust-hello-2.png" class="popup img-link "><img data-src="/assets/img/research/rustversing/rust-hello-2.png" alt="" class="lazyload" data-proofer-ignore></a></p><p>First, a pointer is set to the string we had. Then, Rust creates a <strong>display</strong> that points to it (a pointer to a pointer) and stores the <strong>display</strong> inside a variable called <code class="language-plaintext highlighter-rouge">string_display</code>. This display is then stored in a new variable, which will be the one passed to <code class="language-plaintext highlighter-rouge">_print</code>.</p><p>But what is <code class="language-plaintext highlighter-rouge">core::fmt::Arguments::new_v1</code>? It represents a vector! Rust strings are vectors of bytes (<code class="language-plaintext highlighter-rouge">Vec&lt;u8&gt;</code>). So, we have somewhat deduced the flow of the program.</p><p><br /></p><h3 id="final-thoughts"><span class="mr-2">Final Thoughts</span><a href="#final-thoughts" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>In summary, here are the key observations:</p><ul><li>The <code class="language-plaintext highlighter-rouge">_start</code> function calls the <code class="language-plaintext highlighter-rouge">main</code> function, similar to the C binary.<li>The <code class="language-plaintext highlighter-rouge">main</code> function does not directly start the program but instead calls another main function - <code class="language-plaintext highlighter-rouge">rust::main</code>.<li>The <code class="language-plaintext highlighter-rouge">rust::main</code> function calls the <code class="language-plaintext highlighter-rouge">rust::hello</code> function, just like the C binary.<li>The <code class="language-plaintext highlighter-rouge">rust::hello</code> function retrieves the string and creates a Vector from it.<li>The Vector is then passed to the <code class="language-plaintext highlighter-rouge">_print</code> function.</ul><p><br /> <br /> <br /></p><hr /><p><br /></p><h2 id="strings-strings-and-strings"><span class="mr-2">Strings, Strings and Strings</span><a href="#strings-strings-and-strings" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Now that we have an idea of how Rust binaries can work, let’s see how it handles different types of strings. In particular, we’ll explore the differences between:</p><ul><li><code class="language-plaintext highlighter-rouge">str</code><li><code class="language-plaintext highlighter-rouge">String</code><li>Emojis in strings</ul><p>The code for this example will be simple, just printing different types of strings:</p><div file="rustversing.rs" class="language-rust highlighter-rouge"><div class="code-header"> <span data-label-text="rustversing.rs"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nf">hello</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">fn</span> <span class="nf">hello</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">let</span> <span class="n">var_str</span> <span class="o">=</span> <span class="s">"This is a str!"</span><span class="p">;</span>
    <span class="k">let</span> <span class="n">var_string</span> <span class="o">=</span> <span class="nn">String</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="s">"This is a String"</span><span class="p">);</span>
    <span class="k">let</span> <span class="n">emojis</span> <span class="o">=</span> <span class="s">"This are 🦀🦀🦀!"</span><span class="p">;</span>

    <span class="nd">println!</span><span class="p">(</span><span class="s">"{}"</span><span class="p">,</span> <span class="n">var_str</span><span class="p">);</span>
    <span class="nd">println!</span><span class="p">(</span><span class="s">"{}"</span><span class="p">,</span> <span class="n">var_string</span><span class="p">);</span>
    <span class="nd">println!</span><span class="p">(</span><span class="s">"{}"</span><span class="p">,</span> <span class="n">emojis</span><span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><p>We will start by using cargo to build the binaries. In this case, the resulting file will be <strong>4 MB</strong> in size. We can now check it as we did before:</p><div file="rustversing.rs" class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="rustversing.rs"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="gp">$</span><span class="w"> </span>file target/debug/rustversing
<span class="go">target/debug/rustversing: ELF 64-bit LSB pie executable, x86-64, version 1 (SYSV), 
dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]=576f4cca52f34e240a1185c7201a9bd89ed052d1, 
for GNU/Linux 4.4.0, with debug_info, not stripped
</span></pre></table></code></div></div><div file="rustversing.rs" class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="rustversing.rs"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="gp">$</span><span class="w"> </span>checksec target/debug/rustversing
<span class="go">[*] '/home/zeropio/Code/Lang/Rust/rustversing/target/debug/rustversing'
    Arch:     amd64-64-little
    RELRO:    Full RELRO
    Stack:    No canary found
    NX:       NX enabled
    PIE:      PIE enabled
</span></pre></table></code></div></div><p><br /></p><h3 id="reversing-it"><span class="mr-2">Reversing It</span><a href="#reversing-it" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>The behavior remains the same as before. The <code class="language-plaintext highlighter-rouge">_start</code> function calls <code class="language-plaintext highlighter-rouge">main</code>, which in turn calls <code class="language-plaintext highlighter-rouge">rustversing::main</code>, and finally our <code class="language-plaintext highlighter-rouge">rustversing::hello</code> function. However, this time the function is a little bit different. We can observe this by viewing the graph: <br /> <a href="/assets/img/research/rustversing/graph-1.png" class="popup img-link "><img data-src="/assets/img/research/rustversing/graph-1.png" alt="" class="lazyload" data-proofer-ignore></a></p><p>With our previous knowledge, we can now start cleaning up the binary. The High Level IL view is much cleaner than before. We can begin examining the strings and locate them, just as we did previously: <a href="/assets/img/research/rustversing/strings-1.png" class="popup img-link "><img data-src="/assets/img/research/rustversing/strings-1.png" alt="" class="lazyload" data-proofer-ignore></a></p><p>What do we have here? We can see the delimiter we set (<code class="language-plaintext highlighter-rouge">!</code>) for the emojis, which helps us identify where that string ends. Additionally, we notice a pattern that repeats three times, matching the number of emojis we used. Therefore, we can conclude that the <code class="language-plaintext highlighter-rouge">🦀</code> emoji corresponds to the hex value <code class="language-plaintext highlighter-rouge">0xf09fa680</code>. <a href="/assets/img/research/rustversing/rust-hello-3.png" class="popup img-link "><img data-src="/assets/img/research/rustversing/rust-hello-3.png" alt="" class="lazyload" data-proofer-ignore></a></p><p>Finally, we can observe the same flow as before - a pointer to the string, creation of a display and a vector, and then passing the vector to the <code class="language-plaintext highlighter-rouge">_print</code> function. The binary doesn’t appear to differentiate between <code class="language-plaintext highlighter-rouge">str</code> and <code class="language-plaintext highlighter-rouge">String</code>.</p><p><br /></p><h3 id="final-thoughts-1"><span class="mr-2">Final Thoughts</span><a href="#final-thoughts-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>Emojis are saved as a hex value that the decompiler can’t interpret. This can result in some strings being hidden from decompilers.<li>At a low-level, there is no difference in how <code class="language-plaintext highlighter-rouge">str</code> and <code class="language-plaintext highlighter-rouge">String</code> are used.</ul><p><br /> <br /> <br /></p><hr /><p><br /></p><h2 id="get-some-input"><span class="mr-2">Get Some Input</span><a href="#get-some-input" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Let’s dive into more complex structures by obtaining user input and printing it:</p><div file="rustversing.rs" class="language-rust highlighter-rouge"><div class="code-header"> <span data-label-text="rustversing.rs"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="n">io</span><span class="p">;</span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nf">user_input</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">fn</span> <span class="nf">user_input</span><span class="p">()</span> <span class="p">{</span>
    <span class="nd">println!</span><span class="p">(</span><span class="s">"Please enter some text:"</span><span class="p">);</span>

    <span class="k">let</span> <span class="k">mut</span> <span class="n">input</span> <span class="o">=</span> <span class="nn">String</span><span class="p">::</span><span class="nf">new</span><span class="p">();</span>
    <span class="nn">io</span><span class="p">::</span><span class="nf">stdin</span><span class="p">()</span><span class="nf">.read_line</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="n">input</span><span class="p">);</span>

    <span class="nd">println!</span><span class="p">(</span><span class="s">"You entered: {}"</span><span class="p">,</span> <span class="n">input</span><span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><p>The file size remains the same as before, <strong>4 MB</strong>. Let’s perform a few checks:</p><div file="rustversing.rs" class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="rustversing.rs"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="gp">$</span><span class="w"> </span>file target/debug/rustversing
<span class="go">target/debug/rustversing: ELF 64-bit LSB pie executable, x86-64, version 1 (SYSV), 
dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]=0a9f48a6dc11be4a35ae86367b1d15cd9a8c4ef0,
for GNU/Linux 4.4.0, with debug_info, not stripped
</span></pre></table></code></div></div><div file="rustversing.rs" class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="rustversing.rs"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="gp">$</span><span class="w"> </span>checksec target/debug/rustversing
<span class="go">[*] '/home/zeropio/Code/Lang/Rust/rustversing/target/debug/rustversing'
    Arch:     amd64-64-little
    RELRO:    Full RELRO
    Stack:    No canary found
    NX:       NX enabled
    PIE:      PIE enabled
</span></pre></table></code></div></div><p><br /></p><h3 id="reversing-it-1"><span class="mr-2">Reversing It</span><a href="#reversing-it-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>This binary is slightly different from all the previous ones. Firstly, the number of symbols has greatly increased: <a href="/assets/img/research/rustversing/rust-symbols-1.png" class="popup img-link "><img data-src="/assets/img/research/rustversing/rust-symbols-1.png" alt="" class="lazyload" data-proofer-ignore></a></p><p>Perhaps due to the <code class="language-plaintext highlighter-rouge">use std::io;</code> import, we see all the functions listed there. Additionally, there are now many strings present. We can identify our hardcoded string, as well as some error management outputs: <a href="/assets/img/research/rustversing/rust-strings-1.png" class="popup img-link "><img data-src="/assets/img/research/rustversing/rust-strings-1.png" alt="" class="lazyload" data-proofer-ignore></a></p><p><br /></p><p>And for the first time, we encounter some hardcoded strings: <a href="/assets/img/research/rustversing/rust-user_input-1.png" class="popup img-link "><img data-src="/assets/img/research/rustversing/rust-user_input-1.png" alt="" class="lazyload" data-proofer-ignore></a></p><p>We can proceed to extract them as usual: <a href="/assets/img/research/rustversing/rust-strings-2.png" class="popup img-link "><img data-src="/assets/img/research/rustversing/rust-strings-2.png" alt="" class="lazyload" data-proofer-ignore></a></p><p><br /></p><p>Returning to our <code class="language-plaintext highlighter-rouge">user_input</code> function, we can observe the creation of a <code class="language-plaintext highlighter-rouge">String</code> using the <code class="language-plaintext highlighter-rouge">alloc::string::String::new</code> function. Based on this line:</p><div class="language-c highlighter-rouge"><div class="code-header"> <span data-label-text="C"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="mi">6</span> <span class="err">@</span> <span class="mo">0000</span><span class="mi">8</span><span class="n">c78</span>  <span class="kt">void</span><span class="o">*</span> <span class="n">var_58</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">std</span><span class="o">::</span><span class="n">io</span><span class="o">::</span><span class="n">stdio</span><span class="o">::</span><span class="n">stdin</span><span class="o">::</span><span class="n">INSTANCE</span><span class="o">::</span><span class="n">h98fb20affa94f4af</span>
</pre></table></code></div></div><p>We can infer that <code class="language-plaintext highlighter-rouge">var_58</code> serves as an error handler, while the last variable (<code class="language-plaintext highlighter-rouge">var_68</code>) holds the actual input provided by the user. Then, as always, a vector is created with the contents of the string and passed to <code class="language-plaintext highlighter-rouge">_print</code> along with our <code class="language-plaintext highlighter-rouge">second_print</code> function: <a href="/assets/img/research/rustversing/rust-user_input-2.png" class="popup img-link "><img data-src="/assets/img/research/rustversing/rust-user_input-2.png" alt="" class="lazyload" data-proofer-ignore></a></p><p><br /></p><h3 id="final-thoughts-2"><span class="mr-2">Final Thoughts</span><a href="#final-thoughts-2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>Rust always creates a <code class="language-plaintext highlighter-rouge">display</code> and <code class="language-plaintext highlighter-rouge">vector</code> for strings.<li>Rust creates an error handler before calling <code class="language-plaintext highlighter-rouge">read_line</code>.</ul><p><br /> <br /> <br /></p><hr /><p><br /></p><h2 id="calling-the-system"><span class="mr-2">Calling the System</span><a href="#calling-the-system" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>In order to make system calls, we will use <strong>libc</strong> since we are working with a Linux host. Let’s start by importing the dependency:</p><div file="Cargo.toml" class="language-toml highlighter-rouge"><div class="code-header"> <span data-label-text="Cargo.toml"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nn">[dependencies]</span>
<span class="py">libc</span> <span class="p">=</span> <span class="s">"0.2"</span>
</pre></table></code></div></div><p>Now we can create our program:</p><div file="main.rs" class="language-rust highlighter-rouge"><div class="code-header"> <span data-label-text="main.rs"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="k">extern</span> <span class="k">crate</span> <span class="n">libc</span><span class="p">;</span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">unsafe</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">message</span> <span class="o">=</span> <span class="s">"Hello, World!</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
        <span class="k">let</span> <span class="n">len</span> <span class="o">=</span> <span class="n">message</span><span class="nf">.len</span><span class="p">();</span>

        <span class="k">let</span> <span class="n">syscall_result</span> <span class="o">=</span> <span class="nn">libc</span><span class="p">::</span><span class="nf">write</span><span class="p">(</span><span class="nn">libc</span><span class="p">::</span><span class="n">STDOUT_FILENO</span><span class="p">,</span> <span class="n">message</span><span class="nf">.as_ptr</span><span class="p">()</span> <span class="k">as</span> <span class="o">*</span><span class="k">const</span> <span class="nn">libc</span><span class="p">::</span><span class="nb">c_void</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
        
        <span class="k">if</span> <span class="n">syscall_result</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="p">{</span>
            <span class="nd">println!</span><span class="p">(</span><span class="s">"Syscall failed"</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Notice how we need to encapsulate it within an <code class="language-plaintext highlighter-rouge">unsafe</code> block. System calls involve low-level control, and the <code class="language-plaintext highlighter-rouge">unsafe</code> block is used to signal to the Rust compiler that certain safety guarantees are being bypassed. Using syscalls can lead to incorrect usage. Therefore, we are implementing our own error handling in case of errors.</p><p>Let’s do the checks:</p><div file="rustversing.rs" class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="rustversing.rs"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="gp">$</span><span class="w"> </span>file target/debug/rustversing
<span class="go">target/debug/rustversing: ELF 64-bit LSB pie executable, x86-64, version 1 (SYSV), 
dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]=5b5498c5c59bd6016ee452254343a774958c1730, 
for GNU/Linux 4.4.0, with debug_info, not stripped
</span></pre></table></code></div></div><div file="rustversing.rs" class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="rustversing.rs"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="gp">$</span><span class="w"> </span>checksec target/debug/rustversing
<span class="go">[*] '/home/zeropio/Code/Lang/Rust/rustversing/target/debug/rustversing'
    Arch:     amd64-64-little
    RELRO:    Full RELRO
    Stack:    No canary found
    NX:       NX enabled
    PIE:      PIE enabled
</span></pre></table></code></div></div><p>For this case, we are going to compare with a C program:</p><div file="syscall.c" class="language-c highlighter-rouge"><div class="code-header"> <span data-label-text="syscall.c"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp">
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="kt">char</span><span class="o">*</span> <span class="n">message</span> <span class="o">=</span> <span class="s">"Hello, World!</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
    <span class="kt">size_t</span> <span class="n">len</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">message</span><span class="p">);</span>

    <span class="kt">ssize_t</span> <span class="n">syscall_result</span> <span class="o">=</span> <span class="n">write</span><span class="p">(</span><span class="n">STDOUT_FILENO</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">syscall_result</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"Syscall failed</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><p>And its checks:</p><div file="syscall" class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="syscall"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="gp">$</span><span class="w"> </span>file syscall
<span class="go">syscall: ELF 64-bit LSB pie executable, x86-64, version 1 (SYSV), dynamically linked, 
interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]=06660856c07818cd0b2605b213da9cf4490ea962, 
for GNU/Linux 4.4.0, not stripped
</span></pre></table></code></div></div><div file="syscall" class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="syscall"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="gp">$</span><span class="w"> </span>checksec syscall
<span class="go">[*] '/home/zeropio/Desktop/rustversing/syscall'
    Arch:     amd64-64-little
    RELRO:    Partial RELRO
    Stack:    No canary found
    NX:       NX enabled
    PIE:      PIE enabled
</span></pre></table></code></div></div><p><br /></p><h3 id="reversing-it-2"><span class="mr-2">Reversing It</span><a href="#reversing-it-2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>First, let’s examine the C binary. As expected, it is quite simple: <a href="/assets/img/research/rustversing/c-syscall-1.png" class="popup img-link "><img data-src="/assets/img/research/rustversing/c-syscall-1.png" alt="" class="lazyload" data-proofer-ignore></a> <em>C binary</em></p><p>The Rust code appears to be larger… but why? In C, the program writes the string and then compares its length. If the length is valid, it uses <code class="language-plaintext highlighter-rouge">puts</code> to print it. However, in Rust, the output of <code class="language-plaintext highlighter-rouge">write</code> is saved to the <code class="language-plaintext highlighter-rouge">rax_2</code> variable. Then, the same comparison is made, and if it is valid, a vector is created with the string and the <code class="language-plaintext highlighter-rouge">_print</code> function is used to print it. <a href="/assets/img/research/rustversing/rust-syscall-1.png" class="popup img-link "><img data-src="/assets/img/research/rustversing/rust-syscall-1.png" alt="" class="lazyload" data-proofer-ignore></a> <em>Rust binary</em></p><p><br /></p><h3 id="final-thoughts-3"><span class="mr-2">Final Thoughts</span><a href="#final-thoughts-3" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>Rust and C manifest similar behavior, but Rust always uses vectors as the underlying structure for printing strings.</ul><p><br /> <br /> <br /></p><hr /><p><br /></p><h2 id="some-binary-exploitation"><span class="mr-2">Some Binary Exploitation</span><a href="#some-binary-exploitation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>I couldn’t resist exploring some binary exploitation, even in Rust. However, for the purpose of this post, I focused on easily readable bugs. Here’s what I came up with:</p><div file="main.rs" class="language-rust highlighter-rouge"><div class="code-header"> <span data-label-text="main.rs"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="n">io</span><span class="p">;</span>

<span class="k">fn</span> <span class="nf">vulnerable_function</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="nb">u32</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">result</span><span class="p">:</span> <span class="nb">u32</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="mi">0</span><span class="o">..</span><span class="n">value</span> <span class="p">{</span>
        <span class="n">result</span> <span class="o">+=</span> <span class="n">i</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nd">println!</span><span class="p">(</span><span class="s">"Result: {}"</span><span class="p">,</span> <span class="n">result</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nd">println!</span><span class="p">(</span><span class="s">"Enter a value:"</span><span class="p">);</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">input</span> <span class="o">=</span> <span class="nn">String</span><span class="p">::</span><span class="nf">new</span><span class="p">();</span>
    <span class="nn">io</span><span class="p">::</span><span class="nf">stdin</span><span class="p">()</span><span class="nf">.read_line</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="n">input</span><span class="p">)</span><span class="nf">.expect</span><span class="p">(</span><span class="s">"Failed to read input."</span><span class="p">);</span>
    <span class="k">let</span> <span class="n">value</span><span class="p">:</span> <span class="nb">u32</span> <span class="o">=</span> <span class="n">input</span><span class="nf">.trim</span><span class="p">()</span><span class="nf">.parse</span><span class="p">()</span><span class="nf">.expect</span><span class="p">(</span><span class="s">"Invalid input."</span><span class="p">);</span>
    <span class="nf">vulnerable_function</span><span class="p">(</span><span class="n">value</span><span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><p>As you may have guessed, it involves an integer overflow. As soon as you send it <code class="language-plaintext highlighter-rouge">4294967294</code>, the program crashes:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>Enter a value:
4294967294
thread 'main' panicked at 'attempt to add with overflow', src/main.rs:6:9
</pre></table></code></div></div><p>Let’s do the check:</p><div file="rustversing.rs" class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="rustversing.rs"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="gp">$</span><span class="w"> </span>file target/debug/rustversing
<span class="go">target/debug/rustversing: ELF 64-bit LSB pie executable, x86-64, version 1 (SYSV), 
dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]=87d1b9d9da069d8d66c2e1fe035361e0c0d36cee, 
for GNU/Linux 4.4.0, with debug_info, not stripped
</span></pre></table></code></div></div><div file="rustversing.rs" class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="rustversing.rs"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="gp">$</span><span class="w"> </span>checksec target/debug/rustversing
<span class="go">[*] '/home/zeropio/Code/Lang/Rust/rustversing/target/debug/rustversing'
    Arch:     amd64-64-little
    RELRO:    Full RELRO
    Stack:    No canary found
    NX:       NX enabled
    PIE:      PIE enabled
</span></pre></table></code></div></div><p><br /></p><h3 id="reversing-it-3"><span class="mr-2">Reversing It</span><a href="#reversing-it-3" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><a href="/assets/img/research/rustversing/rust-integer-overflow-1.png" class="popup img-link "><img data-src="/assets/img/research/rustversing/rust-integer-overflow-1.png" alt="" class="lazyload" data-proofer-ignore></a></p><p>Similar to before, the binary prompts the user for input (<code class="language-plaintext highlighter-rouge">std::io::stdio::Stdin::read_line</code>) and allocates a <code class="language-plaintext highlighter-rouge">String</code> from it. Then, it assigns the result to <code class="language-plaintext highlighter-rouge">rax_5</code> and passes it to the <code class="language-plaintext highlighter-rouge">rustversing::vulnerable_function</code> function. Notably, all the error messages are already hardcoded in the program. Unlike the earlier strings, Binja can access these strings.</p><h4 id="vulnerable-function"><span class="mr-2">Vulnerable Function</span><a href="#vulnerable-function" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>In this case, the graph for <code class="language-plaintext highlighter-rouge">rustversing::vulnerable_function</code> is more <em>complex</em>: <a href="/assets/img/research/rustversing/graph-2.png" class="popup img-link "><img data-src="/assets/img/research/rustversing/graph-2.png" alt="" class="lazyload" data-proofer-ignore></a></p><p>Rust is calling the <code class="language-plaintext highlighter-rouge">_$LT$I$u20$as$u20$core.....tor$GT$::into_iter</code> function, which we can guess is the conversion of an iterator from our string. It then enters an infinite loop: <a href="/assets/img/research/rustversing/rust-integer-overflow-2.png" class="popup img-link "><img data-src="/assets/img/research/rustversing/rust-integer-overflow-2.png" alt="" class="lazyload" data-proofer-ignore></a> <em>First block</em></p><p>The input is iterated byte by byte. If the byte is <code class="language-plaintext highlighter-rouge">0</code>, it jumps to the rest of the program, indicating that it executed correctly. While looping, the binary checks the least significant byte in the second <code class="language-plaintext highlighter-rouge">if</code> statement. If it is set, the program jumps to the <code class="language-plaintext highlighter-rouge">core::panicking::panic</code> function, terminating the execution.</p><p>At this point, panicking prevents the propagation of an integer overflow. Therefore, although Rust is not fully protected against it, it can handle it by terminating the program. <a href="/assets/img/research/rustversing/rust-integer-overflow-3.png" class="popup img-link "><img data-src="/assets/img/research/rustversing/rust-integer-overflow-3.png" alt="" class="lazyload" data-proofer-ignore></a> <em>Blurr to help focus</em></p><p>If everything is correct, the program continues execution from where it left off. <a href="/assets/img/research/rustversing/rust-integer-overflow-4.png" class="popup img-link "><img data-src="/assets/img/research/rustversing/rust-integer-overflow-4.png" alt="" class="lazyload" data-proofer-ignore></a> <em>Last block</em></p><p><br /></p><h3 id="final-thoughts-4"><span class="mr-2">Final Thoughts</span><a href="#final-thoughts-4" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>Rust’s panic handler helps prevent some exploitations.<li>Unsafe blocks are not completely ignored by the compiler (some vulnerable codes attempted here returned errors).</ul><p><br /> <br /> <br /></p><hr /><p><br /></p><h2 id="final-notes"><span class="mr-2">Final Notes</span><a href="#final-notes" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>I would like to highlight that Rust, by default, allocates its structures on the heap. While attempting to explore “<em>Stack vs Heap</em>”, I discovered that Rust seems to use the heap for almost everything, including vectors (which constitute the majority of the data) and boxes. Perhaps in future posts, I will explore deeper into this topic and provide more insights.</p><p>From this overview, we can conclude the following:</p><ul><li>The <code class="language-plaintext highlighter-rouge">_start</code> function calls the <code class="language-plaintext highlighter-rouge">main</code> function, similar to the C binary.<li>The <code class="language-plaintext highlighter-rouge">main</code> function doesn’t start the program directly; instead, it calls another main function: <code class="language-plaintext highlighter-rouge">rust::main</code>.<li>The <code class="language-plaintext highlighter-rouge">rust::main</code> function calls the <code class="language-plaintext highlighter-rouge">rust::hello</code> function, just like the C binary.<li>The <code class="language-plaintext highlighter-rouge">rust::hello</code> function retrieves the string and creates a vector from it.<li>The vector is then passed to the <code class="language-plaintext highlighter-rouge">_print</code> function.<li>Emojis are saved as hex values that the decompiler can’t interpret, potentially hiding some strings from decompilers.<li>At a low level, there is no difference in how <code class="language-plaintext highlighter-rouge">str</code> and <code class="language-plaintext highlighter-rouge">String</code> are used.<li>Rust always creates a <code class="language-plaintext highlighter-rouge">display</code> and <code class="language-plaintext highlighter-rouge">vector</code> for strings.<li>Rust creates an error handler before calling <code class="language-plaintext highlighter-rouge">read_line</code>.<li>Rust and C exhibit similar behavior, but Rust always uses vectors as the underlying structure for printing strings.<li>The panic handler in Rust helps prevent some exploitations.<li>Unsafe blocks are not completely ignored by the compiler.</ul><p>Although I feel that there is much more to explore, I don’t want to write an excessively lengthy post reviewing every Rust struct in detail — at least not in a single post. In future posts, I plan to delve into more structs, malware, and binary exploitation.</p><p>Stay tuned!</p><p><br /> <br /> <br /></p><hr /><p><br /></p><h2 id="references"><span class="mr-2">References</span><a href="#references" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li><a href="https://people.eecs.berkeley.edu/~daw/papers/shadow-asiaccs15.pdf">The Performance Cost of Shadow Stacks and Stack Canaries</a><li><a href="https://doc.rust-lang.org/rust-by-example/std/str.html">Rust By Examples - Strings</a><li><a href="https://doc.rust-lang.org/std/io/struct.Stdin.html">std::io::Stdin Rust Doc</a></ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/research/'>research</a>, <a href='/categories/rustversing/'>rustversing</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/research/" class="post-tag no-text-decoration" >research</a> <a href="/tags/reversing/" class="post-tag no-text-decoration" >reversing</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Reversing%20Rust%201%20%7C%20Research%20-%20Zeropio's%20Dojo&url=https%3A%2F%2Fzeropio.ninja%2F%2Fresearch%2Frustversing%2Fpart-1" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Reversing%20Rust%201%20%7C%20Research%20-%20Zeropio's%20Dojo&u=https%3A%2F%2Fzeropio.ninja%2F%2Fresearch%2Frustversing%2Fpart-1" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fzeropio.ninja%2F%2Fresearch%2Frustversing%2Fpart-1&text=Reversing%20Rust%201%20%7C%20Research%20-%20Zeropio's%20Dojo" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/index">Index</a><li><a href="/sensei/shellcode-blacksmith">The Shellcode Blacksmith | Sensei</a><li><a href="/lowlevel/osdev/chapter-0">OSDev | Chapter 0 | Basic Kernel</a><li><a href="/malware/development/putty-1">MalDev | Putty</a><li><a href="/malware/development/dropper-explorer-1">MalDev | Dropper Explorer.exe</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/lowlevel/">lowlevel</a> <a class="post-tag" href="/tags/malware/">malware</a> <a class="post-tag" href="/tags/osdev/">osdev</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/research/">research</a> <a class="post-tag" href="/tags/reversing/">reversing</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc"></nav></div><script src="https://cdn.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.js"></script></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4 mt-5"><div id="related-posts" class="mb-2 mb-sm-4"><h3 class="pt-2 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/sensei/shellcode-blacksmith"><div class="card-body"> <em class="small" data-ts="1683583200" data-df="ll" > May 9, 2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>The Shellcode Blacksmith | Sensei</h3><div class="text-muted small"><p> Welcome to the first post of my series on various low level topics. In this series, I will focus as deeply as possible into more advanced topics, rather than simply explaining common vulnerabilit...</p></div></div></a></div><div class="card"> <a href="/lowlevel/osdev/chapter-4"><div class="card-body"> <em class="small" data-ts="1682546400" data-df="ll" > Apr 27, 2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>OSDev | Chapter 4 | Memory Management</h3><div class="text-muted small"><p> Introduction In this part, we will implement two key memory management features: paging, which enables mapping physical memory to virtual memory, and heap allocation, which provides dynamic memory...</p></div></div></a></div><div class="card"> <a href="/lowlevel/osdev/chapter-3"><div class="card-body"> <em class="small" data-ts="1682460000" data-df="ll" > Apr 26, 2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>OSDev | Chapter 3 | Interrupts</h3><div class="text-muted small"><p> Introduction To create a functional OS, it is essential to handle errors such as division by zero, attempts to access non-existent memory addresses, and other potential issues. One approach to han...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/sensei/shellcode-blacksmith" class="btn btn-outline-primary" prompt="Older"><p>The Shellcode Blacksmith | Sensei</p></a><div class="btn btn-outline-primary disabled" prompt="Newer"><p>-</p></div></div></div></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/lowlevel/">lowlevel</a> <a class="post-tag" href="/tags/malware/">malware</a> <a class="post-tag" href="/tags/osdev/">osdev</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/research/">research</a> <a class="post-tag" href="/tags/reversing/">reversing</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><footer><div class="container pl-lg-4 pr-lg-4"><div class="d-flex justify-content-between align-items-center text-muted ml-md-3 mr-md-3"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://twitter.com/ZeropioWasTaken">zeropio</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0">Using the <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> theme <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a>.</p></div></div></div></footer><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1.1.0/dist/jquery.magnific-popup.min.js,npm/lazysizes@5.3.2/lazysizes.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1.11.6/dayjs.min.js,npm/dayjs@1.11.6/locale/en.min.js,npm/dayjs@1.11.6/plugin/relativeTime.min.js,npm/dayjs@1.11.6/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
